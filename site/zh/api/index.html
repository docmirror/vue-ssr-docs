<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API 参考 | Vue SSR 指南</title>
    <meta name="description" content="Vue.js 服务端渲染指南">
    
    
    <link rel="preload" href="/assets/css/0.styles.6216b4ed.css" as="style"><link rel="preload" href="/assets/js/app.e9ae4cd3.js" as="script"><link rel="preload" href="/assets/js/14.98252396.js" as="script"><link rel="prefetch" href="/assets/js/31.e70f56c9.js"><link rel="prefetch" href="/assets/js/1.4ba6ebae.js"><link rel="prefetch" href="/assets/js/2.535f3c53.js"><link rel="prefetch" href="/assets/js/3.e5730be8.js"><link rel="prefetch" href="/assets/js/4.0d83e6d4.js"><link rel="prefetch" href="/assets/js/5.9206f5fa.js"><link rel="prefetch" href="/assets/js/6.01fc6541.js"><link rel="prefetch" href="/assets/js/7.044d3af9.js"><link rel="prefetch" href="/assets/js/8.6a2b3380.js"><link rel="prefetch" href="/assets/js/9.63f778c7.js"><link rel="prefetch" href="/assets/js/10.f7960911.js"><link rel="prefetch" href="/assets/js/11.a592910a.js"><link rel="prefetch" href="/assets/js/12.6717a33d.js"><link rel="prefetch" href="/assets/js/13.682a40a0.js"><link rel="prefetch" href="/assets/js/15.fcc3f916.js"><link rel="prefetch" href="/assets/js/16.18e3e209.js"><link rel="prefetch" href="/assets/js/17.d5012f0a.js"><link rel="prefetch" href="/assets/js/18.3facfce8.js"><link rel="prefetch" href="/assets/js/19.6bced45f.js"><link rel="prefetch" href="/assets/js/20.f31829e2.js"><link rel="prefetch" href="/assets/js/21.9f5a2bb3.js"><link rel="prefetch" href="/assets/js/22.67a7b679.js"><link rel="prefetch" href="/assets/js/23.86b71d0a.js"><link rel="prefetch" href="/assets/js/24.9a66fd58.js"><link rel="prefetch" href="/assets/js/25.f9522ed8.js"><link rel="prefetch" href="/assets/js/26.6e7f9c0d.js"><link rel="prefetch" href="/assets/js/27.e9d08b47.js"><link rel="prefetch" href="/assets/js/28.76611bff.js"><link rel="prefetch" href="/assets/js/29.ea593b17.js"><link rel="prefetch" href="/assets/js/30.c5eb0f84.js"><link rel="prefetch" href="/assets/js/32.5f5dd21a.js"><link rel="prefetch" href="/assets/js/33.0a625a25.js"><link rel="prefetch" href="/assets/js/34.d2733537.js"><link rel="prefetch" href="/assets/js/35.ddc557a5.js"><link rel="prefetch" href="/assets/js/36.a489edf1.js"><link rel="prefetch" href="/assets/js/37.136d8c88.js"><link rel="prefetch" href="/assets/js/38.cf5a3a6d.js"><link rel="prefetch" href="/assets/js/39.e9646dd4.js"><link rel="prefetch" href="/assets/js/40.4ce1a813.js"><link rel="prefetch" href="/assets/js/41.da8c6de2.js"><link rel="prefetch" href="/assets/js/42.c04c89ae.js"><link rel="prefetch" href="/assets/js/43.150fa123.js"><link rel="prefetch" href="/assets/js/44.fe85991f.js"><link rel="prefetch" href="/assets/js/45.a7ccbd7a.js"><link rel="prefetch" href="/assets/js/46.80bff42e.js"><link rel="prefetch" href="/assets/js/47.3938d7f5.js"><link rel="prefetch" href="/assets/js/48.bc91a1ba.js"><link rel="prefetch" href="/assets/js/49.311640c6.js"><link rel="prefetch" href="/assets/js/50.d3346077.js"><link rel="prefetch" href="/assets/js/51.e7924f3c.js"><link rel="prefetch" href="/assets/js/52.41301aea.js"><link rel="prefetch" href="/assets/js/53.ef26fe4d.js"><link rel="prefetch" href="/assets/js/54.5f99a77e.js"><link rel="prefetch" href="/assets/js/55.b28f8acf.js"><link rel="prefetch" href="/assets/js/56.c1e1643d.js"><link rel="prefetch" href="/assets/js/57.bfaa829e.js"><link rel="prefetch" href="/assets/js/58.97c40fd9.js"><link rel="prefetch" href="/assets/js/59.96f5b32e.js"><link rel="prefetch" href="/assets/js/60.5605712f.js"><link rel="prefetch" href="/assets/js/61.5678ceef.js"><link rel="prefetch" href="/assets/js/62.6717708a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6216b4ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vue SSR 指南</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/api/" class="nav-link router-link-exact-active router-link-active">API 参考</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/api/" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/ja/" class="nav-link">日本語</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">Русский</a></li></ul></div></div> <a href="https://github.com/vuejs/vue-ssr-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/api/" class="nav-link router-link-exact-active router-link-active">API 参考</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/api/" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/ja/" class="nav-link">日本語</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">Русский</a></li></ul></div></div> <a href="https://github.com/vuejs/vue-ssr-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div style="padding:20px 30px  0px 30px;"><a target="_blank" href="https://www.aliyun.com/minisite/goods?userCode=qya11txb" style="width:100%"><img src="https://img.alicdn.com/tfs/TB1qnR3R1L2gK0jSZFmXXc7iXXa-440-240.jpg" style="width:100%"></a></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>API 参考</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/zh/api/#createrenderer" class="sidebar-link">createRenderer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/api/#createbundlerenderer" class="sidebar-link">createBundleRenderer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/api/#class-renderer" class="sidebar-link">Class: Renderer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/api/#renderer-rendertostring" class="sidebar-link">renderer.renderToString</a></li><li class="sidebar-sub-header"><a href="/zh/api/#renderer-rendertostream" class="sidebar-link">renderer.renderToStream</a></li></ul></li><li><a href="/zh/api/#class-bundlerenderer" class="sidebar-link">Class: BundleRenderer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/api/#bundlerenderer-rendertostring" class="sidebar-link">bundleRenderer.renderToString</a></li><li class="sidebar-sub-header"><a href="/zh/api/#bundlerenderer-rendertostream" class="sidebar-link">bundleRenderer.renderToStream</a></li></ul></li><li><a href="/zh/api/#renderer-选项" class="sidebar-link">Renderer 选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/api/#template" class="sidebar-link">template</a></li><li class="sidebar-sub-header"><a href="/zh/api/#clientmanifest" class="sidebar-link">clientManifest</a></li><li class="sidebar-sub-header"><a href="/zh/api/#inject" class="sidebar-link">inject</a></li><li class="sidebar-sub-header"><a href="/zh/api/#shouldpreload" class="sidebar-link">shouldPreload</a></li><li class="sidebar-sub-header"><a href="/zh/api/#shouldprefetch" class="sidebar-link">shouldPrefetch</a></li><li class="sidebar-sub-header"><a href="/zh/api/#runinnewcontext" class="sidebar-link">runInNewContext</a></li><li class="sidebar-sub-header"><a href="/zh/api/#basedir" class="sidebar-link">basedir</a></li><li class="sidebar-sub-header"><a href="/zh/api/#cache" class="sidebar-link">cache</a></li><li class="sidebar-sub-header"><a href="/zh/api/#directives" class="sidebar-link">directives</a></li></ul></li><li><a href="/zh/api/#webpack-插件" class="sidebar-link">webpack 插件</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="api-参考"><a href="#api-参考" aria-hidden="true" class="header-anchor">#</a> API 参考</h1> <h2 id="createrenderer"><a href="#createrenderer" aria-hidden="true" class="header-anchor">#</a> createRenderer</h2> <p>使用（可选的）<a href="#renderer-options">选项</a>创建一个 <a href="#class-renderer"><code>Renderer</code></a> 实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* 选项 */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="createbundlerenderer"><a href="#createbundlerenderer" aria-hidden="true" class="header-anchor">#</a> createBundleRenderer</h2> <p>使用 server bundle 和（可选的）<a href="#renderer-options">选项</a>创建一个 <a href="#class-bundlerenderer"><code>BundleRenderer</code></a> 实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createBundleRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createBundleRenderer</span><span class="token punctuation">(</span>serverBundle<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* 选项 */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>serverBundle</code> 参数可以是以下之一：</p> <ul><li><p>绝对路径，指向一个已经构建好的 bundle 文件（<code>.js</code> 或 <code>.json</code>）。必须以 <code>/</code> 开头才会被识别为文件路径。</p></li> <li><p>由 webpack + <code>vue-server-renderer/server-plugin</code> 生成的 bundle 对象。</p></li> <li><p>JavaScript 代码字符串（不推荐）。</p></li></ul> <p>更多细节请查看 <a href="/zh/guide/bundle-renderer.html">Server Bundle 指引</a> 和 <a href="/zh/guide/build-config.html">构建配置</a>。</p> <h2 id="class-renderer"><a href="#class-renderer" aria-hidden="true" class="header-anchor">#</a> Class: Renderer</h2> <h3 id="renderer-rendertostring"><a href="#renderer-rendertostring" aria-hidden="true" class="header-anchor">#</a> renderer.renderToString</h3> <p>函数签名:</p> <div class="language-js extra-class"><pre class="language-js"><code>renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token punctuation">,</span> callback<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span>Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
</code></pre></div><p>将 Vue 实例渲染为字符串。上下文对象 (context object) 可选。回调函数是典型的 Node.js 风格回调，其中第一个参数是可能抛出的错误，第二个参数是渲染完毕的字符串。</p> <p>在 2.5.0+ 版本中，此 callback 回调函数是可选项。在不传递 callback 时，此方法返回一个 Promise 对象，在其  resolve 后返回最终渲染的 HTML。</p> <h3 id="renderer-rendertostream"><a href="#renderer-rendertostream" aria-hidden="true" class="header-anchor">#</a> renderer.renderToStream</h3> <p>函数签名:</p> <div class="language-js extra-class"><pre class="language-js"><code>renderer<span class="token punctuation">.</span><span class="token function">renderToStream</span><span class="token punctuation">(</span>vm<span class="token punctuation">[</span><span class="token punctuation">,</span> context<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> stream<span class="token punctuation">.</span>Readable
</code></pre></div><p>将 Vue 实例渲染为一个 <a href="https://nodejs.org/dist/latest-v8.x/docs/api/stream.html#stream_readable_streams" target="_blank" rel="noopener noreferrer">Node.js 可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。上下文对象 (context object) 可选。更多细节请查看<a href="/zh/guide/streaming.html">流式渲染</a>。</p> <h2 id="class-bundlerenderer"><a href="#class-bundlerenderer" aria-hidden="true" class="header-anchor">#</a> Class: BundleRenderer</h2> <h3 id="bundlerenderer-rendertostring"><a href="#bundlerenderer-rendertostring" aria-hidden="true" class="header-anchor">#</a> bundleRenderer.renderToString</h3> <p>函数签名:</p> <div class="language-js extra-class"><pre class="language-js"><code>bundleRenderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token punctuation">[</span>context<span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span>Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
</code></pre></div><p>将 bundle 渲染为字符串。上下文对象 (context object) 可选。回调是一个典型的 Node.js 风格回调，其中第一个参数是可能抛出的错误，第二个参数是渲染完毕的字符串。</p> <p>在 2.5.0+ 版本中，此 callback 回调函数是可选项。在不传递 callback 时，此方法返回一个 Promise 对象，在其  resolve 后返回最终渲染的 HTML。</p> <h3 id="bundlerenderer-rendertostream"><a href="#bundlerenderer-rendertostream" aria-hidden="true" class="header-anchor">#</a> bundleRenderer.renderToStream</h3> <p>函数签名:</p> <div class="language-js extra-class"><pre class="language-js"><code>bundleRenderer<span class="token punctuation">.</span><span class="token function">renderToStream</span><span class="token punctuation">(</span><span class="token punctuation">[</span>context<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> stream<span class="token punctuation">.</span>Readable
</code></pre></div><p>将 bundle 渲染为一个 <a href="https://nodejs.org/dist/latest-v8.x/docs/api/stream.html#stream_readable_streams" target="_blank" rel="noopener noreferrer">Node.js 可读流<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。上下文对象 (context object) 可选。更多细节请查看<a href="/zh/guide/streaming.html">流式渲染</a>。</p> <h2 id="renderer-选项"><a href="#renderer-选项" aria-hidden="true" class="header-anchor">#</a> Renderer 选项</h2> <h3 id="template"><a href="#template" aria-hidden="true" class="header-anchor">#</a> template</h3> <p>为整个页面的 HTML 提供一个模板。此模板应包含注释 <code>&lt;!--vue-ssr-outlet--&gt;</code>，作为渲染应用程序内容的占位符。</p> <p>模板还支持使用渲染上下文 (render context) 进行基本插值：</p> <ul><li>使用双花括号 (double-mustache) 进行 HTML 转义插值 (HTML-escaped interpolation)；</li> <li>使用三花括号 (triple-mustache) 进行 HTML 不转义插值 (non-HTML-escaped interpolation)。</li></ul> <p>当在渲染上下文 (render context) 上存在一些特定属性时，模板会自动注入对应的内容：</p> <ul><li><p><code>context.head</code>：（字符串）将会被作为 HTML 注入到页面的头部 (head) 里。</p></li> <li><p><code>context.styles</code>：（字符串）内联 CSS，将以 style 标签的形式注入到页面头部。注意，如果你使用了 <code>vue-loader</code> + <code>vue-style-loader</code> 来处理组件 CSS，此属性会在构建过程中被自动生成。</p></li> <li><p><code>context.state</code>：（对象）初始 Vuex store 状态，将以 <code>window.__INITIAL_STATE__</code> 的形式内联到页面。内联的 JSON 将使用 <a href="https://github.com/yahoo/serialize-javascript" target="_blank" rel="noopener noreferrer">serialize-javascript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  自动清理，以防止 XSS 攻击。</p> <p>在 2.5.0+ 版本中，嵌入式 script 也可以在生产模式 (production mode) 下自行移除。</p></li></ul> <p>此外，当提供 <code>clientManifest</code> 时，模板会自动注入以下内容：</p> <ul><li>渲染当前页面所需的最优客户端 JavaScript 和 CSS 资源（支持自动推导异步代码分割所需的文件）；</li> <li>为要渲染页面提供最佳的 <code>&lt;link rel=&quot;preload/prefetch&quot;&gt;</code> 资源提示 (resource hints)。</li></ul> <p>你也可以通过将 <code>inject: false</code> 传递给 renderer，来禁用所有自动注入。</p> <p>具体查看：</p> <ul><li><a href="/zh/guide/#using-a-page-template">使用一个页面模板</a></li> <li><a href="/zh/guide/build-config.html#manual-asset-injection">手动资源注入(Manual Asset Injection)</a></li></ul> <h3 id="clientmanifest"><a href="#clientmanifest" aria-hidden="true" class="header-anchor">#</a> clientManifest</h3> <p>通过此选项提供一个由 <code>vue-server-renderer/client-plugin</code> 生成的客户端构建 manifest 对象(client build manifest object)。此对象包含了 webpack 整个构建过程的信息，从而可以让 bundle renderer 自动推导需要在 HTML 模板中注入的内容。更多详细信息，请查看<a href="/zh/guide/build-config.html#generating-clientmanifest">生成 clientManifest</a>。</p> <h3 id="inject"><a href="#inject" aria-hidden="true" class="header-anchor">#</a> inject</h3> <p>控制使用 <code>template</code> 时是否执行自动注入。默认是 <code>true</code>。</p> <p>参考：<a href="/zh/guide/build-config.html#manual-asset-injection">手动资源注入(Manual Asset Injection)</a>。</p> <h3 id="shouldpreload"><a href="#shouldpreload" aria-hidden="true" class="header-anchor">#</a> shouldPreload</h3> <p>一个函数，用来控制什么文件应该生成 <code>&lt;link rel=&quot;preload&quot;&gt;</code> 资源预加载提示 (resource hints)。</p> <p>默认情况下，只有 JavaScript 和 CSS 文件会被预加载，因为它们是启动应用时所必需的。</p> <p>对于其他类型的资源（如图像或字体），预加载过多可能会浪费带宽，甚至损害性能，因此预加载什么资源具体依赖于场景。你可以使用 <code>shouldPreload</code> 选项精确控制预加载资源：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createBundleRenderer</span><span class="token punctuation">(</span>bundle<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  template<span class="token punctuation">,</span>
  clientManifest<span class="token punctuation">,</span>
  shouldPreload<span class="token punctuation">:</span> <span class="token punctuation">(</span>file<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 基于文件扩展名的类型推断。</span>
    <span class="token comment">// https://fetch.spec.whatwg.org/#concept-request-destination</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'script'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'style'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'font'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 只预加载 woff2 字体</span>
      <span class="token keyword">return</span> <span class="token operator">/</span>\<span class="token punctuation">.</span>woff2$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'image'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 只预加载重要 images</span>
      <span class="token keyword">return</span> file <span class="token operator">===</span> <span class="token string">'hero.jpg'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="shouldprefetch"><a href="#shouldprefetch" aria-hidden="true" class="header-anchor">#</a> shouldPrefetch</h3> <ul><li>2.5.0+</li></ul> <p>一个函数，用来控制对于哪些文件，是需要生成 <code>&lt;link rel=&quot;prefetch&quot;&gt;</code> 资源提示。</p> <p>默认情况下，异步 chunk 中的所有资源都将被预取，因为这是低优先级指令; 然而，为了更好地控制带宽使用情况，你也可以自定义要预取的资源。此选项具有与 <code>shouldPreload</code> 相同的函数签名。</p> <h3 id="runinnewcontext"><a href="#runinnewcontext" aria-hidden="true" class="header-anchor">#</a> runInNewContext</h3> <ul><li>只用于 <code>createBundleRenderer</code></li> <li>期望值：<code>boolean | 'once'</code>（<code>'once'</code> 只在 2.3.1+ 支持）</li></ul> <p>默认情况下，对于每次渲染，bundle renderer 将创建一个新的 V8 上下文并重新执行整个 bundle。这具有一些好处 - 例如，应用程序代码与服务器进程隔离，我们无需担心文档中提到的<a href="/zh/guide/structure.html#avoid-stateful-singletons">状态单例问题</a>。然而，这种模式有一些相当大的性能开销，因为重新创建上下文并执行整个 bundle 还是相当昂贵的，特别是当应用很大的时候。</p> <p>出于向后兼容的考虑，此选项默认为 <code>true</code>，但建议你尽可能使用 <code>runInNewContext: false</code> 或 <code>runInNewContext: 'once'</code>。</p> <blockquote><p>在 2.3.0 中，此选项有一个 bug，其中 <code>runInNewContext: false</code> 仍然使用独立的全局上下文 (separate global context) 执行 bundle。以下信息假定版本为 2.3.1+。</p></blockquote> <p>使用 <code>runInNewContext: false</code>，bundle 代码将与服务器进程在同一个 <code>global</code> 上下文中运行，所以请留意在应用程序代码中尽量避免修改 <code>global</code>。</p> <p>使用 <code>runInNewContext: 'once'</code> (2.3.1+)，bundle 将在独立的<code>全局</code>上下文(separate global context)取值，然而只在启动时取值一次。这提供了一定程度的应用程序代码隔离，因为它能够防止 bundle 中的代码意外污染服务器进程的 <code>global</code> 对象。注意事项如下：</p> <ol><li>在此模式下，修改 <code>global</code>（例如，polyfill）的依赖模块必须被打包进 bundle，不能被外部化 (externalize)；</li> <li>从 bundle 执行返回的值将使用不同的全局构造函数，例如，在服务器进程中捕获到 bundle 内部抛出的错误，使用的是 bundle 上下文中的 Error 构造函数，所以它不会是服务器进程中 <code>Error</code> 的一个实例。</li></ol> <p>参考：<a href="/zh/guide/structure.html">源码结构</a></p> <h3 id="basedir"><a href="#basedir" aria-hidden="true" class="header-anchor">#</a> basedir</h3> <ul><li>只用于 <code>createBundleRenderer</code></li></ul> <p>显式地声明 server bundle 的运行目录。运行时将会以此目录为基准来解析 <code>node_modules</code> 中的依赖模块。只有在所生成的 bundle 文件与外部的 NPM 依赖模块放置在不同位置，或者 <code>vue-server-renderer</code> 是通过 NPM link 链接到当前项目中时，才需要配置此选项。</p> <h3 id="cache"><a href="#cache" aria-hidden="true" class="header-anchor">#</a> cache</h3> <p>提供<a href="/zh/guide/caching.html#component-level-caching">组件缓存</a>具体实现。缓存对象必须实现以下接口（使用 Flow 语法表示）：</p> <div class="language-js extra-class"><pre class="language-js"><code>type RenderCache <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> cb<span class="token operator">?</span><span class="token punctuation">:</span> Function<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> string <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> val<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  has<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> cb<span class="token operator">?</span><span class="token punctuation">:</span> Function<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>典型用法是传入 <a href="https://github.com/isaacs/node-lru-cache" target="_blank" rel="noopener noreferrer">lru-cache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">LRU</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lru-cache'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token punctuation">:</span> <span class="token constant">LRU</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    max<span class="token punctuation">:</span> <span class="token number">10000</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>请注意，缓存对象应至少要实现 <code>get</code> 和 <code>set</code>。此外，如果 <code>get</code> 和 <code>has</code> 接收第二个参数作为回调，那 <code>get</code> 和 <code>has</code> 也可以是可选的异步函数。这允许缓存使用异步 API，例如，一个 Redis 客户端：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      redisClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理任何错误</span>
        <span class="token function">cb</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      redisClient<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="directives"><a href="#directives" aria-hidden="true" class="header-anchor">#</a> directives</h3> <p>对于自定义指令，允许提供服务器端实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  directives<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">example</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> directiveMeta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 基于指令绑定元数据(metadata)转换 vnode</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>例如，请查看 <a href="https://github.com/vuejs/vue/blob/dev/src/platforms/web/server/directives/show.js" target="_blank" rel="noopener noreferrer"><code>v-show</code> 的服务器端实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="webpack-插件"><a href="#webpack-插件" aria-hidden="true" class="header-anchor">#</a> webpack 插件</h2> <p>webpack 插件作为独立文件提供，并且应当直接 require：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueSSRServerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer/server-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> VueSSRClientPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-server-renderer/client-plugin'</span><span class="token punctuation">)</span>
</code></pre></div><p>生成的默认文件是：</p> <ul><li><code>vue-ssr-server-bundle.json</code> 用于服务器端插件；</li> <li><code>vue-ssr-client-manifest.json</code> 用于客户端插件。</li></ul> <p>创建插件实例时可以自定义文件名：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> plugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueSSRServerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filename<span class="token punctuation">:</span> <span class="token string">'my-server-bundle.json'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>更多信息请查看<a href="/zh/guide/build-config.html">构建配置</a>。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/14.98252396.js" defer></script><script src="/assets/js/app.e9ae4cd3.js" defer></script>
  </body>
</html>
